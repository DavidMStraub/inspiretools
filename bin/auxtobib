#!/usr/bin/env python3

import argparse
import sys
import inspiretools
import pyinspire

parser = argparse.ArgumentParser()
parser.add_argument("file", help="LaTeX .aux file",type=str)
args = parser.parse_args()

texkeys =  inspiretools.aux2texkey(args.file)

err=''
notfound=''
for texkey in texkeys:
    try:
        bib = pyinspire.get_text_from_inspire('texkey ' + texkey, 'bibtex')
        if bib != '':
            print(bib)
        else:
            notfound  += texkey + '\n'
    except KeyboardInterrupt:
        print('The reference extraction has been aborted before completion.')
        break
    except:
        err += texkey + '\n'

if err != '':
    print('The following references could not be extracted due to errors:\n')
    print(err)

if notfound != '':
    print('The following references could not be found on INSPIRE:\n')
    print(notfound)
